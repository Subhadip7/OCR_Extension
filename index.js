!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.DrawingTool=e():t.DrawingTool=e()}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="./",i(i.s=13)}([function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var s=(r=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=n.sources.map((function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"}));return[i].concat(o).concat([s]).join("\n")}var r;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var o=this[s][0];null!=o&&(n[o]=!0)}for(s=0;s<t.length;s++){var r=t[s];null!=r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),e.push(r))}},e}},function(t,e,i){t.exports=i.p+"80627d297839e7c75ed1392c9dadb9f1.eot"},function(t,e,i){var n,s,o={},r=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===s&&(s=n.apply(this,arguments)),s}),a=function(t,e){return e?e.querySelector(t):document.querySelector(t)},h=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var n=a.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),l=null,c=0,d=[],u=i(9);function p(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=o[n.id];if(s){s.refs++;for(var r=0;r<s.parts.length;r++)s.parts[r](n.parts[r]);for(;r<n.parts.length;r++)s.parts.push(y(n.parts[r],e))}else{var a=[];for(r=0;r<n.parts.length;r++)a.push(y(n.parts[r],e));o[n.id]={id:n.id,refs:1,parts:a}}}}function m(t,e){for(var i=[],n={},s=0;s<t.length;s++){var o=t[s],r=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};n[r]?n[r].parts.push(a):i.push(n[r]={id:r,parts:[a]})}return i}function v(t,e){var i=h(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),d.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=h(t.insertAt.before,i);i.insertBefore(e,s)}}function f(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=d.indexOf(t);e>=0&&d.splice(e,1)}function x(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return g(e,t.attrs),v(t,e),e}function g(t,e){Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}function y(t,e){var i,n,s,o;if(e.transform&&t.css){if(!(o="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var r=c++;i=l||(l=x(e)),n=E.bind(null,i,r,!1),s=E.bind(null,i,r,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",g(e,t.attrs),v(t,e),e}(e),n=S.bind(null,i,e),s=function(){f(i),i.href&&URL.revokeObjectURL(i.href)}):(i=x(e),n=C.bind(null,i),s=function(){f(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=m(t,e);return p(i,e),function(t){for(var n=[],s=0;s<i.length;s++){var r=i[s];(a=o[r.id]).refs--,n.push(a)}t&&p(m(t,e),e);for(s=0;s<n.length;s++){var a;if(0===(a=n[s]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete o[a.id]}}}};var b,w=(b=[],function(t,e){return b[t]=e,b.filter(Boolean).join("\n")});function E(t,e,i,n){var s=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=w(e,s);else{var o=document.createTextNode(s),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}function C(t,e){var i=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function S(t,e,i){var n=i.css,s=i.sourceMap,o=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||o)&&(n=u(n)),s&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var r=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}},function(t,e,i){var n=i(4);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){e=t.exports=i(0)(!1);var n=i(5),s=n(i(1)),o=n(i(1)+"#iefix"),r=n(i(6)),a=n(i(7)),h=n(i(8)+"#icomoon");e.push([t.i,"@font-face{font-family:icomoon;src:url("+s+");src:url("+o+') format("embedded-opentype"),url('+r+') format("truetype"),url('+a+') format("woff"),url('+h+') format("svg");font-weight:400;font-style:normal}[class*=" icon-"],[class^=icon-]{font-family:icomoon!important;speak:none;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-arrow:before{content:"\\e900"}.icon-arrow-lg:before{content:"\\e901"}.icon-arrow-light:before{content:"\\e902"}.icon-arrow-md:before{content:"\\e903"}.icon-back:before{content:"\\e904"}.icon-cancel:before{content:"\\e905"}.icon-close:before{content:"\\e906"}.icon-close-transparent:before{content:"\\e907"}.icon-copy:before{content:"\\e908"}.icon-delete:before{content:"\\e909"}.icon-ellipse:before{content:"\\e90a"}.icon-eraser:before{content:"\\e90b"}.icon-eye:before{content:"\\e90c"}.icon-facebook:before{content:"\\e90d"}.icon-google:before{content:"\\e90e"}.icon-instagram:before{content:"\\e90f"}.icon-line:before{content:"\\e910"}.icon-link:before{content:"\\e911"}.icon-linkedin:before{content:"\\e912"}.icon-marker:before{content:"\\e913"}.icon-movement:before{content:"\\e914"}.icon-next:before{content:"\\e915"}.icon-pencil:before{content:"\\e916"}.icon-printer:before{content:"\\e917"}.icon-rectangle:before{content:"\\e918"}.icon-redo:before{content:"\\e919"}.icon-save:before{content:"\\e91a"}.icon-search-file:before{content:"\\e91b"}.icon-text:before{content:"\\e91c"}.icon-twitter:before{content:"\\e91d"}.icon-undo:before{content:"\\e91e"}.icon-upload:before{content:"\\e91f"}',""])},function(t,e,i){"use strict";t.exports=function(t,e){return"string"!=typeof t?t:(/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),/["'() \t\n]/.test(t)||e?'"'+t.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':t)}},function(t,e,i){t.exports=i.p+"f6ccd96325c3f93769d794aafbe04fd2.ttf"},function(t,e,i){t.exports=i.p+"7aaa8fe5bb58968143e244b3fbb6cfc0.woff"},function(t,e,i){t.exports=i.p+"915c4133ad023b777ee5f5a8a7d4ac75.svg"},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,n=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var s,o=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(s=0===o.indexOf("//")?o:0===o.indexOf("/")?i+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")}))}},function(t,e,i){var n=i(11);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){(t.exports=i(0)(!1)).push([t.i,'body{margin:0;padding:0;font-family:sans-serif;color:#111;background:transparent;position:fixed}#drawingTool,body{width:100%;height:100vh}#drawingTool{overflow:hidden;position:absolute;top:0;left:0}.drawing-menu{padding:0;background:#f0f0f0;position:absolute;margin:0;z-index:100;border-radius:3px}.drawing-menu li{list-style:none;float:left;position:relative}.drawing-menu li .screenshotlink{position:absolute;padding:0;background-color:#ccc;color:#fff;left:-340px;height:26px;line-height:26px;border-radius:3px}.drawing-menu li .screenshotlink li{display:flex}.drawing-menu li .screenshotlink li a{font-size:12px}.drawing-menu li .screenshotlink li a .icon{font-size:16px}.drawing-menu li .screenshotlink li a .link-to-detail{color:#007bff}.drawing-menu li a{cursor:pointer;padding:0 5px;-webkit-user-select:none;-moz-user-select:none;user-select:none;display:flex;justify-content:center;align-items:center;height:28px;font-size:16px;text-decoration:none;color:#2d2d2d}.drawing-menu li a#move{cursor:move;width:15px;background-color:#dadada;border-radius:3px 0 0 3px;margin-right:5px;border-right:1px solid #ccc}.drawing-menu li a.color #inputColor{border:0;background-color:transparent;padding:0;margin:0;width:20px;height:20px}.drawing-menu li a.color #inputColor:focus{box-shadow:none;outline:unset}.drawing-menu li a.active span,.drawing-menu li a.active span:before{color:red}.drawing-menu li a.unactive{color:#ccc}#imageView{border:0}#imageTemp{position:absolute;top:0;left:0}#movingText{width:auto;height:auto;position:absolute;border:10px solid transparent;cursor:move}#movingText .insertText{z-index:10;padding:3px;background:none;outline:none;resize:none;margin:0;font-family:Helvetica;overflow:hidden;border:1px dashed #000;width:30px}#spanTextCalc,.liText{position:absolute;visibility:hidden;height:auto;width:auto;white-space:nowrap}.liText{display:inline}.croppr-container *{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.croppr-container img{vertical-align:middle;max-width:100%}.croppr{position:relative;display:inline-block}#cropprImage,.croppr{width:100%;height:100vh}.croppr-overlay{background:rgba(0,0,0,.7);position:absolute;top:0;right:0;bottom:0;left:0;z-index:1;cursor:crosshair}.croppr-region{position:absolute;z-index:3;cursor:move;top:0;border:2px dashed #e0e0e0}.croppr-imageClipped{position:absolute;top:0;right:0;bottom:0;left:0;z-index:2;pointer-events:none;width:100%;height:100vh}.croppr-handle{border:1px solid #000;background-color:#fff;width:10px;height:10px;position:absolute;z-index:4;top:0}.cursor-draw{position:absolute;border-radius:50%;transform:translateX(-50%) translateY(-50%);background-color:transparent;border:1px solid;z-index:10;top:30px;left:30px;display:none}.tooltip{position:relative;display:inline-block}.tooltip .tooltiptext{visibility:hidden;width:65px;background-color:#555;color:#fff;text-align:center;border-radius:3px;padding:0 5px;position:absolute;z-index:1;bottom:32px;left:-25px;opacity:0;transition:opacity .3s}.tooltip .tooltiptext:after{content:"";position:absolute;top:100%;left:50%;margin-left:-5px;border:5px solid transparent;border-top-color:#555}.tooltip:hover .tooltiptext{visibility:visible;opacity:1}#snackbar{visibility:hidden;min-width:250px;margin-left:-125px;background-color:#28a745;color:#fff;text-align:center;border-radius:2px;padding:8px;position:fixed;z-index:10;left:50%;top:30px;font-size:17px}#snackbar.show{visibility:visible}',""])},function(t,e){!function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var n=(new Date).getTime(),s=Math.max(0,16-(n-t)),o=window.setTimeout((function(){e(n+s)}),s);return t=n+s,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(){if("function"==typeof window.CustomEvent)return!1;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}t.prototype=window.Event.prototype,window.CustomEvent=t}(),function(t){try{return new CustomEvent("test"),!1}catch(t){}function e(e,i){i=i||{bubbles:!1,cancelable:!1};var n=document.createEvent("MouseEvent");return n.initMouseEvent(e,i.bubbles,i.cancelable,t,0,0,0,0,0,!1,!1,!1,!1,0,null),n}e.prototype=Event.prototype,t.MouseEvent=e}(window)},function(t,e,i){"use strict";i.r(e);i(3),i(10),i(12);class n{constructor(t,e,i,n){var s=this;function o(t){t.stopPropagation(),document.removeEventListener("mouseup",o),document.removeEventListener("mousemove",r),s.eventBus.dispatchEvent(new CustomEvent("handleend",{detail:{handle:s}}))}function r(t){t.stopPropagation(),s.eventBus.dispatchEvent(new CustomEvent("handlemove",{detail:{mouseX:t.clientX,mouseY:t.clientY}}))}this.position=t,this.constraints=e,this.cursor=i,this.eventBus=n,this.el=document.createElement("div"),this.el.className="croppr-handle",this.el.style.cursor=i,this.el.addEventListener("mousedown",(function(t){t.stopPropagation(),document.addEventListener("mouseup",o),document.addEventListener("mousemove",r),s.eventBus.dispatchEvent(new CustomEvent("handlestart",{detail:{handle:s}}))}))}}class s{constructor(t,e,i,n){this.x1=t,this.y1=e,this.x2=i,this.y2=n}set(t=null,e=null,i=null,n=null){return this.x1=null==t?this.x1:t,this.y1=null==e?this.y1:e,this.x2=null==i?this.x2:i,this.y2=null==n?this.y2:n,this}width(){return Math.abs(this.x2-this.x1)}height(){return Math.abs(this.y2-this.y1)}resize(t,e,i=[0,0]){const n=this.x1+this.width()*i[0],s=this.y1+this.height()*i[1];return this.x1=n-t*i[0],this.y1=s-e*i[1],this.x2=this.x1+t,this.y2=this.y1+e,this}scale(t,e=[0,0]){const i=this.width()*t,n=this.height()*t;return this.resize(i,n,e),this}move(t=null,e=null){let i=this.width(),n=this.height();return t=null===t?this.x1:t,e=null===e?this.y1:e,this.x1=t,this.y1=e,this.x2=t+i,this.y2=e+n,this}getRelativePoint(t=[0,0]){return[this.width()*t[0],this.height()*t[1]]}getAbsolutePoint(t=[0,0]){return[this.x1+this.width()*t[0],this.y1+this.height()*t[1]]}constrainToRatio(t,e=[0,0],i="height"){if(null===t)return;this.width(),this.height();switch(i){case"height":this.resize(this.width(),this.width()*t,e);break;case"width":this.resize(1*this.height()/t,this.height(),e);break;default:this.resize(this.width(),this.width()*t,e)}return this}constrainToBoundary(t,e,i=[0,0]){const[n,s]=this.getAbsolutePoint(i),o=n,r=s,a=t-n,h=e-s,l=-2*i[0]+1,c=-2*i[1]+1;let[d,u]=[null,null];switch(l){case-1:d=o;break;case 0:d=2*Math.min(o,a);break;case 1:d=a}switch(c){case-1:u=r;break;case 0:u=2*Math.min(r,h);break;case 1:u=h}if(this.width()>d){const t=d/this.width();this.scale(t,i)}if(this.height()>u){const t=u/this.height();this.scale(t,i)}return this}constrainToSize(t=null,e=null,i=null,n=null,s=[0,0],o=null){if(o&&(o>1?(t=1*e/o,n*=o):o<1&&(e=t*o,i=1*n/o)),t&&this.width()>t){const i=t,n=null===o?this.height():e;this.resize(i,n,s)}if(e&&this.height()>e){const i=null===o?this.width():t,n=e;this.resize(i,n,s)}if(i&&this.width()<i){const t=i,e=null===o?this.height():n;this.resize(t,e,s)}if(n&&this.height()<n){const t=null===o?this.width():i,e=n;this.resize(t,e,s)}return this}}function o(t){t.preventDefault();const e=t.changedTouches[0];e.target.dispatchEvent(new MouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[t.type],{bubbles:!0,cancelable:!0,view:window,clientX:e.clientX,clientY:e.clientY,screenX:e.screenX,screenY:e.screenY}))}const r=[{position:[0,0],constraints:[1,0,0,1],cursor:"nw-resize"},{position:[.5,0],constraints:[1,0,0,0],cursor:"n-resize"},{position:[1,0],constraints:[1,1,0,0],cursor:"ne-resize"},{position:[1,.5],constraints:[0,1,0,0],cursor:"e-resize"},{position:[1,1],constraints:[0,1,1,0],cursor:"se-resize"},{position:[.5,1],constraints:[0,0,1,0],cursor:"s-resize"},{position:[0,1],constraints:[0,0,1,1],cursor:"sw-resize"},{position:[0,.5],constraints:[0,0,0,1],cursor:"w-resize"}];class a{constructor(t,e,i=!1){if(this.options=a.parseOptions(e||{}),!t.nodeName&&null==(t=document.querySelector(t)))throw"Unable to find element.";if(!t.getAttribute("src"))throw"Image src not provided.";this._initialized=!1,this._restore={parent:t.parentNode,element:t},i||(0===t.width||0===t.height?t.onload=()=>{this.initialize(t)}:this.initialize(t))}initialize(t){this.createDOM(t),this.options.convertToPixels(this.cropperEl),this.attachHandlerEvents(),this.attachRegionEvents(),this.attachOverlayEvents(),this.box=this.initializeBox(this.options),this.redraw(),this._initialized=!0,null!==this.options.onInitialize&&this.options.onInitialize(this)}createDOM(t){var e;this.containerEl=document.createElement("div"),this.containerEl.className="croppr-container",this.eventBus=this.containerEl,(e=this.containerEl).addEventListener("touchstart",o),e.addEventListener("touchend",o),e.addEventListener("touchmove",o),this.cropperEl=document.createElement("div"),this.cropperEl.className="croppr",this.imageEl=document.createElement("canvas"),this.imageEl.className="croppr-image",this.imageEl.id="cropprImage",this.imageClippedEl=this.imageEl.cloneNode(),this.imageClippedEl.className="croppr-imageClipped",this.imageClippedEl.id="cropprImageClipped",this.regionEl=document.createElement("div"),this.regionEl.className="croppr-region",this.regionEl.id="cropprRegion",this.overlayEl=document.createElement("div"),this.overlayEl.className="croppr-overlay";let i=document.createElement("div");i.className="croppr-handleContainer",this.handles=[];for(let t=0;t<r.length;t++){const e=new n(r[t].position,r[t].constraints,r[t].cursor,this.eventBus);this.handles.push(e),i.appendChild(e.el)}this.cropperEl.appendChild(this.imageEl),this.cropperEl.appendChild(this.imageClippedEl),this.cropperEl.appendChild(this.regionEl),this.cropperEl.appendChild(this.overlayEl),this.cropperEl.appendChild(i),this.containerEl.appendChild(this.cropperEl),t.parentElement.replaceChild(this.containerEl,t)}destroy(){this._restore.parent.replaceChild(this._restore.element,this.containerEl)}initializeBox(t){const e=t.startSize.width,i=t.startSize.height;let n=new s(0,0,e,i);n.constrainToRatio(t.aspectRatio,[.5,.5]);const o=t.minSize,r=t.maxSize;n.constrainToSize(r.width,r.height,o.width,o.height,[.5,.5],t.aspectRatio);const a=this.cropperEl.offsetWidth,h=this.cropperEl.offsetHeight;n.constrainToBoundary(a,h,[.5,.5]);const l=this.cropperEl.offsetWidth/2-n.width()/2,c=this.cropperEl.offsetHeight/2-n.height()/2;return n.move(l,c),n}redraw(){const t=Math.round(this.box.width()),e=Math.round(this.box.height()),i=Math.round(this.box.x1),n=Math.round(this.box.y1),s=Math.round(this.box.x2),o=Math.round(this.box.y2);window.requestAnimationFrame(()=>{this.regionEl.style.top=n+"px",this.regionEl.style.left=i+"px",this.regionEl.style.width=t+"px",this.regionEl.style.height=e+"px",this.imageClippedEl.style.clip=`rect(${n}px, ${s}px, ${o}px, ${i}px)`;const r=this.box.getAbsolutePoint([.5,.5]),a=r[0]-this.cropperEl.offsetWidth/2>>31,h=r[1]-this.cropperEl.offsetHeight/2>>31,l=-2*((a^h)+h+h+4)+8;for(let s=0;s<this.handles.length;s++){let o=this.handles[s];const r=o.el.offsetWidth,a=o.el.offsetHeight,h=i+t*o.position[0]-r/2,c=n+e*o.position[1]-a/2;o.el.style.transform=`translate(${Math.round(h)}px, ${Math.round(c)}px)`,o.el.style.zIndex=l==s?5:4}})}attachHandlerEvents(){const t=this.eventBus;t.addEventListener("handlestart",this.onHandleMoveStart.bind(this)),t.addEventListener("handlemove",this.onHandleMoveMoving.bind(this)),t.addEventListener("handleend",this.onHandleMoveEnd.bind(this))}attachRegionEvents(){const t=this.eventBus;function e(e){e.stopPropagation(),t.dispatchEvent(new CustomEvent("regionmove",{detail:{mouseX:e.clientX,mouseY:e.clientY}}))}function i(n){n.stopPropagation(),document.removeEventListener("mouseup",i),document.removeEventListener("mousemove",e),t.dispatchEvent(new CustomEvent("regionend",{detail:{mouseX:n.clientX,mouseY:n.clientY}}))}this.regionEl.addEventListener("mousedown",(function(n){n.stopPropagation(),document.addEventListener("mouseup",i),document.addEventListener("mousemove",e),t.dispatchEvent(new CustomEvent("regionstart",{detail:{mouseX:n.clientX,mouseY:n.clientY}}))})),this.regionEl.addEventListener("dblclick",function(e){e.stopPropagation(),this.fullScreen?(this.box.move(this.tempValue.x,this.tempValue.y),this.box.resize(this.tempValue.width,this.tempValue.height,[0,0]),this.redraw(),t.dispatchEvent(new CustomEvent("regionend",{detail:{mouseX:this.tempValue.x,mouseY:this.tempValue.y}})),this.fullScreen=!1):(this.tempValue=this.getValue(),this.box.move(0,0),this.box.resize(window.innerWidth,window.innerHeight,[0,0]),this.redraw(),t.dispatchEvent(new CustomEvent("regionend",{detail:{mouseX:0,mouseY:0}})),this.fullScreen=!0)}.bind(this)),t.addEventListener("regionstart",this.onRegionMoveStart.bind(this)),t.addEventListener("regionmove",this.onRegionMoveMoving.bind(this)),t.addEventListener("regionend",this.onRegionMoveEnd.bind(this))}attachOverlayEvents(){const t=this;let e=null;function i(e){e.stopPropagation(),t.eventBus.dispatchEvent(new CustomEvent("handlemove",{detail:{mouseX:e.clientX,mouseY:e.clientY}}))}function n(s){s.stopPropagation(),document.removeEventListener("mouseup",n),document.removeEventListener("mousemove",i),1!==t.box.width()||1!==t.box.height()?t.eventBus.dispatchEvent(new CustomEvent("handleend",{detail:{mouseX:s.clientX,mouseY:s.clientY}})):t.box=e}this.overlayEl.addEventListener("mousedown",(function(o){o.stopPropagation(),document.addEventListener("mouseup",n),document.addEventListener("mousemove",i);const r=t.cropperEl.getBoundingClientRect(),a=o.clientX-r.left,h=o.clientY-r.top;e=t.box,t.box=new s(a,h,a+1,h+1),t.eventBus.dispatchEvent(new CustomEvent("handlestart",{detail:{handle:t.handles[4]}}))}))}onHandleMoveStart(t){let e=t.detail.handle;const i=[1-e.position[0],1-e.position[1]];let[n,s]=this.box.getAbsolutePoint(i);this.activeHandle={handle:e,originPoint:i,originX:n,originY:s},null!==this.options.onCropStart&&this.options.onCropStart(this.getValue())}onHandleMoveMoving(t){let{mouseX:e,mouseY:i}=t.detail,n=this.cropperEl.getBoundingClientRect();e-=n.left,i-=n.top,e<0?e=0:e>n.width&&(e=n.width),i<0?i=0:i>n.height&&(i=n.height);let o=this.activeHandle.originPoint.slice();const r=this.activeHandle.originX,a=this.activeHandle.originY,h=this.activeHandle.handle,l=1===h.constraints[0],c=1===h.constraints[1],d=1===h.constraints[2],u=1===h.constraints[3],p=(u||c)&&(l||d);let m=u||c?r:this.box.x1,v=u||c?r:this.box.x2,f=l||d?a:this.box.y1,x=l||d?a:this.box.y2;m=u?e:m,v=c?e:v,f=l?i:f,x=d?i:x;let[g,y]=[!1,!1];if((u||c)&&(g=u?e>r:e<r),(l||d)&&(y=l?i>a:i<a),g){const t=m;m=v,v=t,o[0]=1-o[0]}if(y){const t=f;f=x,x=t,o[1]=1-o[1]}let b=new s(m,f,v,x);if(this.options.aspectRatio){const t=this.options.aspectRatio;let e=!1;p?e=i>b.y1+t*b.width()||i<b.y2-t*b.width():(l||d)&&(e=!0);const n=e?"width":"height";b.constrainToRatio(t,o,n)}const w=this.options.minSize,E=this.options.maxSize;b.constrainToSize(E.width,E.height,w.width,w.height,o,this.options.aspectRatio);const C=this.cropperEl.offsetWidth,S=this.cropperEl.offsetHeight;b.constrainToBoundary(C,S,o),this.box=b,this.redraw(),null!==this.options.onCropMove&&this.options.onCropMove(this.getValue()),this.fullScreen=!1}onHandleMoveEnd(t){null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue())}onRegionMoveStart(t){let{mouseX:e,mouseY:i}=t.detail,n=this.cropperEl.getBoundingClientRect();e-=n.left,i-=n.top,this.currentMove={offsetX:e-this.box.x1,offsetY:i-this.box.y1},null!==this.options.onCropStart&&this.options.onCropStart(this.getValue())}onRegionMoveMoving(t){let{mouseX:e,mouseY:i}=t.detail,{offsetX:n,offsetY:s}=this.currentMove,o=this.cropperEl.getBoundingClientRect();e-=o.left,i-=o.top,this.box.move(e-n,i-s),this.box.x1<0&&this.box.move(0,null),this.box.x2>o.width&&this.box.move(o.width-this.box.width(),null),this.box.y1<0&&this.box.move(null,0),this.box.y2>o.height&&this.box.move(null,o.height-this.box.height()),this.redraw(),null!==this.options.onCropMove&&this.options.onCropMove(this.getValue()),this.getValue().width==window.innerWidth&&this.getValue().height==window.innerHeight?this.fullScreen=!0:this.fullScreen=!1}onRegionMoveEnd(t){null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue())}getValue(t=null){if(null===t&&(t=this.options.returnMode),"real"==t){const t=this.imageEl.clientWidth,e=this.imageEl.clientHeight,{width:i,height:n}=this.imageEl.getBoundingClientRect(),s=t/i,o=e/n;Math.round(this.box.x1*s),Math.round(this.box.y1*o),Math.round(this.box.width()*s),Math.round(this.box.height()*o);return{x:Math.round(this.box.x1*s),y:Math.round(this.box.y1*o),width:Math.round(this.box.width()*s),height:Math.round(this.box.height()*o)}}if("ratio"==t){const{width:t,height:e}=this.imageEl.getBoundingClientRect();return{x:h(this.box.x1/t,3),y:h(this.box.y1/e,3),width:h(this.box.width()/t,3),height:h(this.box.height()/e,3)}}if("raw"==t)return{x:Math.round(this.box.x1),y:Math.round(this.box.y1),width:Math.round(this.box.width()),height:Math.round(this.box.height())}}static parseOptions(t){const e=null,i={width:null,height:null},n={width:null,height:null},s={width:100,height:100,unit:"%"},o="real",r=null,a=null,h=null,l=null;let c=null;void 0!==t.aspectRatio&&("number"==typeof t.aspectRatio?c=t.aspectRatio:t.aspectRatio instanceof Array&&(c=t.aspectRatio[1]/t.aspectRatio[0]));let d=null;void 0!==t.maxSize&&null!==t.maxSize&&(d={width:t.maxSize[0]||null,height:t.maxSize[1]||null,unit:t.maxSize[2]||"px"});let u=null;void 0!==t.minSize&&null!==t.minSize&&(u={width:t.minSize[0]||null,height:t.minSize[1]||null,unit:t.minSize[2]||"px"});let p=null;void 0!==t.startSize&&null!==t.startSize&&(p={width:t.startSize[0]||null,height:t.startSize[1]||null,unit:t.startSize[2]||"%"});let m=null;"function"==typeof t.onInitialize&&(m=t.onInitialize);let v=null;"function"==typeof t.onCropStart&&(v=t.onCropStart);let f=null;"function"==typeof t.onCropEnd&&(f=t.onCropEnd);let x=null;"function"==typeof t.onUpdate&&(console.warn("Croppr.js: `onUpdate` is deprecated and will be removed in the next major release. Please use `onCropMove` or `onCropEnd` instead."),x=t.onUpdate),"function"==typeof t.onCropMove&&(x=t.onCropMove);let g=null;if(void 0!==t.returnMode){const e=t.returnMode.toLowerCase();if(-1===["real","ratio","raw"].indexOf(e))throw"Invalid return mode.";g=e}const y=(t,e)=>null!==t?t:e;return{aspectRatio:y(c,e),maxSize:y(d,i),minSize:y(u,n),startSize:y(p,s),returnMode:y(g,o),onInitialize:y(m,r),onCropStart:y(v,a),onCropMove:y(x,h),onCropEnd:y(f,l),convertToPixels:function(t){const e=t.offsetWidth,i=t.offsetHeight,n=["maxSize","minSize","startSize"];for(let t=0;t<n.length;t++){const s=n[t];null!==this[s]&&("%"==this[s].unit&&(null!==this[s].width&&(this[s].width=this[s].width/100*e),null!==this[s].height&&(this[s].height=this[s].height/100*i)),delete this[s].unit)}}}}}function h(t,e){return Number(Math.round(t+"e"+e)+"e-"+e)}var l=class extends a{constructor(t,e,i=!1){super(t,e,i)}getValue(t){return super.getValue(t)}destroy(){return super.destroy()}moveTo(t,e){return this.box.move(t,e),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}resizeTo(t,e,i=[.5,.5]){return this.box.resize(t,e,i),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}scaleBy(t,e=[.5,.5]){return this.box.scale(t,e),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}reset(){return this.box=this.initializeBox(this.options),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}};class c{constructor(t){this.context=t.context,this.started=t.started,this.canvas=t.canvas,this.toolName="ellipse",this.canvasx=this.canvas.offsetLeft,this.canvasy=this.canvas.offsetTop,this.last_mousex=this.last_mousey=0,this.mousex=this.mousey=0,this.mousedown=t=>{this.started=!0,this.last_mousex=parseInt(t._x-this.canvasx),this.last_mousey=parseInt(t._y-this.canvasy)},this.mousemove=e=>{if(this.mousex=parseInt(e._x-this.canvasx),this.mousey=parseInt(e._y-this.canvasy),this.started){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.context.beginPath();var i=(this.mousex-this.last_mousex)/2*1,n=(this.mousey-this.last_mousey)/2*1;this.context.scale(i,n);var s=this.last_mousex/i+1,o=this.last_mousey/n+1;this.context.arc(s,o,1,0,2*Math.PI),this.context.restore(),this.context.strokeStyle=t.strokeStyle,this.context.lineWidth=t.lineWidth,this.context.stroke()}},this.mouseup=t=>{this.started&&(this.mousemove(t),this.started=!1)},this.mouseleave=t=>{this.started=!1},this.wheel=t=>{}}}class d{constructor(t){this.context=t.context,this.started=t.started,this.toolName="pencil",this.mousedown=t=>{this.context.beginPath(),this.context.moveTo(t._x,t._y),this.started=!0},this.mousemove=e=>{this.started&&(this.context.lineTo(e._x,e._y),this.context.strokeStyle=t.strokeStyle,this.context.lineWidth=t.lineWidth,this.context.stroke())},this.mouseup=()=>{this.started=!1},this.mouseleave=()=>{this.started=!1},this.wheel=t=>{}}}class u{constructor(t){this.context=t.context,this.started=t.started,this.canvas=t.canvas,this.toolName="rect",this.mousedown=t=>{this.started=!0,this.x0=t._x,this.y0=t._y},this.mousemove=e=>{if(this.started){var i=Math.min(e._x,this.x0),n=Math.min(e._y,this.y0),s=Math.abs(e._x-this.x0),o=Math.abs(e._y-this.y0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height),s&&o&&(this.context.strokeStyle=t.strokeStyle,this.context.lineWidth=t.lineWidth,this.context.strokeRect(i,n,s,o))}},this.mouseup=t=>{this.started=!1},this.mouseleave=t=>{this.started=!1},this.wheel=t=>{}}}class p{constructor(t){this.context=t.context,this.started=t.started,this.toolName="line",this.mousedown=t=>{this.started=!0,this.x0=t._x,this.y0=t._y},this.mousemove=e=>{this.started&&(this.context.clearRect(0,0,t.canvas.width,t.canvas.height),this.context.beginPath(),this.context.moveTo(this.x0,this.y0),this.context.lineTo(e._x,e._y),this.context.strokeStyle=t.strokeStyle,this.context.lineWidth=t.lineWidth,this.context.stroke(),this.context.closePath())},this.mouseup=t=>{this.started&&(this.mousemove(t),this.started=!1)},this.mouseleave=t=>{this.started=!1},this.wheel=t=>{}}}class m{constructor(t){this.context=t.context,this.started=t.started,this.toolName="lineArrow",this.mousedown=t=>{this.started=!0,this.x1=t._x,this.y1=t._y},this.mousemove=e=>{if(this.started&&(this.x2=e._x,this.y2=e._y,this.x1!==this.x2||this.y1!==this.y2)){this.context.clearRect(0,0,t.canvas.width,t.canvas.height),this.context.beginPath(),this.context.moveTo(this.x1,this.y1),this.context.lineTo(this.x2,this.y2),this.context.strokeStyle=t.strokeStyle,this.context.lineWidth=t.lineWidth,this.context.stroke();var i=Math.atan((this.y2-this.y1)/(this.x2-this.x1));i+=(this.x2>this.x1?90:-90)*Math.PI/180,this.drawArrowhead(this.context,this.x2,this.y2,i,t.lineWidth,t.strokeStyle,t.strokeStyle),this.context.closePath()}},this.mouseup=t=>{this.started&&(this.mousemove(t),this.started=!1)},this.mouseleave=t=>{this.started=!1},this.wheel=t=>{}}drawArrowhead(t,e,i,n,s,o,r){t.save(),t.beginPath(),t.translate(e,i),t.rotate(n),t.moveTo(0,0),t.lineTo(s,2*s),t.lineTo(-s,2*s),t.closePath(),t.lineWidth=s,t.strokeStyle=o,t.fillStyle=r,t.stroke(),t.fill(),t.restore()}}class v{constructor(t){this.context=t.context,this.started=t.started,this.textarea=null,this.toolName="text",this.textSize=t.textSize,this.active=!1,this.currentX,this.currentY,this.initialX,this.initialY,this.removeTextarea(t),this.mousedown=e=>{if(this.started=!0,this.x0=e._x,this.y0=e._y,this.textValue){var i=this.textSize;this.context.clearRect(0,0,t.canvas.width,t.canvas.height),this.drawText(this.context,this.textValue,this.lastX,this.lastY+this.textSize,i,t.strokeStyle),t.updateImage(),this.textValue=""}let n=document.getElementById("movingText");n&&n.parentNode.removeChild(n),this.textarea=document.createElement("textarea"),this.textarea.className="insertText",this.textarea.id="insertText",this.textarea.rows=2,this.textarea.style.color=t.strokeStyle,this.textarea.spellcheck=!1,this.textarea.style.lineHeight=this.textSize+"px",this.textarea.style.fontSize=this.textSize+"px",this.textareaMoveable=document.createElement("div"),this.textareaMoveable.className="movingText",this.textareaMoveable.draggable=!0,this.textareaMoveable.id="movingText",this.textareaMoveable.appendChild(this.textarea),document.body.appendChild(this.textareaMoveable),this.textarea.focus();let s=document.getElementById("spanTextCalc");s&&s.parentNode.removeChild(s),this.spanTextCalc=document.createElement("span"),this.spanTextCalc.id="spanTextCalc",document.body.appendChild(this.spanTextCalc),this.textarea.addEventListener("keyup",e=>{this.context.clearRect(0,0,t.canvas.width,t.canvas.height),this.textValue=this.textarea.value,this.lastX=this.x0,this.lastY=this.y0}),this.textarea.addEventListener("keydown",t=>{13==t.keyCode&&(this.textarea.rows=this.textarea.rows+1),this.onTextareaChange()}),this.textarea&&this.textarea.addEventListener("wheel",t=>{this.updateTextareaSize(t),this.onTextareaChange()}),this.textarea.style.top=e.clientY+"px",this.textarea.style.left=e.clientX+"px",this.textareaMoveable.style.top=e.clientY+"px",this.textareaMoveable.style.left=e.clientX+"px",this.textareaMoveable.style.position="absolute",this.textareaMoveable.style.zIndex=10,document.body.addEventListener("touchstart",this.dragStart.bind(this),!1),document.body.addEventListener("touchend",this.dragEnd.bind(this),!1),document.body.addEventListener("touchmove",this.drag.bind(this),!1),document.body.addEventListener("mousedown",this.dragStart.bind(this),!1),document.body.addEventListener("mouseup",this.dragEnd.bind(this),!1),document.body.addEventListener("mouseleave",this.dragEnd.bind(this),!1),document.body.addEventListener("mousemove",this.drag.bind(this),!1)},this.wheel=t=>{this.textarea?(this.updateTextareaSize(t),this.onTextareaChange()):this.textSize++}}onTextareaChange(){this.spanTextCalc.style.fontSize=this.textSize;let t=this.textarea.value.replace(/ /g,"&nbsp;");this.spanTextCalc.innerHTML=t;let e=t.split("\n");if(e&&e.length>1){let t=document.getElementById("ulText");t&&t.parentNode.removeChild(t);var i=document.createElement("ul");i.id="ulText",document.body.appendChild(i),e.forEach((function(t){var e=document.createElement("li");e.className="liText",e.innerHTML=t,i.appendChild(e)}));var n=document.querySelectorAll("li.liText"),s=Array.prototype.slice.call(n).reduce((t,e)=>t.clientWidth>e.clientWidth?t:e);this.spanTextCalc.innerHTML=s.textContent.replace(/ /g,"&nbsp;"),this.textwidth=this.spanTextCalc.clientWidth,this.textarea.style.width=this.textwidth+30}else this.textwidth=this.spanTextCalc.clientWidth,this.textarea.style.width=this.textwidth+30}updateTextareaSize(t){t.deltaY<0&&this.textSize<35&&(this.textSize++,this.textarea.style.lineHeight=this.textSize+"px",this.textarea.style.fontSize=this.textSize+"px"),t.deltaY>0&&this.textSize>10&&(this.textSize--,this.textarea.style.lineHeight=this.textSize+"px",this.textarea.style.fontSize=this.textSize+"px")}drawText(t,e,i,n,s,o){var r=s,a=e.split("\n");t.font=this.textSize+"px Helvetica",t.fillStyle=o;for(var h=0;h<a.length;h++)t.fillText(a[h],i+14,n+h*r+10)}removeTextarea(t){document.querySelectorAll(".toolSelect a").forEach(e=>{e.addEventListener("click",e=>{let i=document.getElementById("insertText"),n=e.currentTarget.className;if("control"!==n&&"move"!==n)if("color"!==n){if(i){if(i.value){var s=this.textSize;this.context.clearRect(0,0,t.canvas.width,t.canvas.height);let e=i.parentNode.offsetTop,n=i.parentNode.offsetLeft;this.drawText(this.context,i.value,n,e+this.textSize,s,t.strokeStyle),t.updateImage(),i.value=""}i.parentNode.removeChild(i)}}else i&&(i.style.color=t.strokeStyle)})})}dragStart(t){"touchstart"===t.type?(this.initialX=t.touches[0].clientX-this.textareaMoveable.offsetLeft||0,this.initialY=t.touches[0].clientY-this.textareaMoveable.offsetTop||0):(this.initialX=t.clientX-this.textareaMoveable.offsetLeft||0,this.initialY=t.clientY-this.textareaMoveable.offsetTop||0),"movingText"===t.target.id&&(this.textareaMoveable.draggable=!0,this.active=!0)}dragEnd(t){this.initialX=this.currentX,this.initialY=this.currentY,this.lastX=this.currentX,this.lastY=this.currentY,this.textareaMoveable.draggable=!1,this.active=!1}drag(t){this.active&&(t.preventDefault(),"touchmove"===t.type?(this.currentX=t.touches[0].clientX-this.initialX,this.currentY=t.touches[0].clientY-this.initialY):(this.currentX=t.clientX-this.initialX,this.currentY=t.clientY-this.initialY),this.xOffset=this.currentX,this.yOffset=this.currentY,this.setPosition(this.currentX,this.currentY,this.textareaMoveable))}setPosition(t,e,i){e<0&&(e=0),e>window.innerHeight&&(e=window.innerHeight),t<0&&(t=0);let n=i.clientWidth,s=window.innerWidth-n;t>s&&(t=s),i.style.top=e+"px",i.style.left=t+"px"}}








class f{constructor(t){this.context=t.context,this.started=t.started,this.toolName="marker",this.points=[],this.mousedown=t=>{this.context.globalAlpha=.4,this.points.push({x:t.clientX,y:t.clientY}),this.started=!0},this.mousemove=e=>{this.started&&(this.points.push({x:e.clientX,y:e.clientY}),this.context.beginPath(),this.context.lineWidth=t.lineWidth+10,this.context.strokeStyle=t.strokeStyle,this.points.length>1&&(this.context.moveTo(this.points[this.points.length-2].x,this.points[this.points.length-2].y),this.context.lineTo(this.points[this.points.length-1].x,this.points[this.points.length-1].y)),this.context.stroke(),this.context.closePath())},this.mouseup=t=>{this.context.globalAlpha=1,this.started=!1,this.points.length=0},this.mouseleave=t=>{this.started=!1,this.points.length=0,this.context.globalAlpha=1},this.wheel=t=>{}}}class x{constructor(t){this.elem=t,this.active=!1,this.currentX,this.currentY,this.initialX,this.initialY}createMenu(t,e){this.ul=document.createElement("ul"),this.ul.className="drawing-menu",this.ul.style.top=t+"px",this.ul.style.left=e+"px",this.xOffset=e,this.yOffset=t,document.body.appendChild(this.ul),[{id:"move",title:"Move",type:"move",icon:'<span class="icon-movement" id="icon-move"></span>'},{id:"pencil",title:"Pencil [Ctrl+P]",type:"tool",icon:'<span class="icon-pencil"></span>'},{id:"marker",title:"Marker [Ctrl+X]",type:"tool",icon:'<span class="icon-marker"></span>'},{id:"line",title:"Line [Ctrl+L]",type:"tool",icon:'<span class="icon-line"></span>'},{id:"lineArrow",title:"Arrow [Ctrl+A]",type:"tool",icon:'<span class="icon-arrow"></span>'},{id:"rect",title:"Rectangle [Ctrl+U]",type:"tool",icon:'<span class="icon-rectangle"></span>'},{id:"ellipse",title:"Ellipse [Ctrl+E]",type:"tool",icon:'<span class="icon-ellipse"></span>'},{id:"text",title:"Text [Ctrl+T]",type:"tool",icon:'<span class="icon-text"></span>'},{id:"color",title:"Color picker [Ctrl+I]",type:"color",value:'<input type="color" value="#ff0000" id="inputColor">'},{id:"undo",title:"Undo [Ctrl+Z]",type:"control",icon:'<span class="icon-undo"></span>'},{id:"redo",title:"Redo [Ctrl+Y]",type:"control",icon:'<span class="icon-redo"></span>'},{id:"copyClipboard",title:"Copy to clipboard [Ctrl+C]",type:"copyClipboard",icon:'<span class="icon-copy"></span>'},{id:"save",title:"Save [Ctrl+S]",type:"save",icon:'<span class="icon-save"></span>'},{id:"close",title:"Close [Esc]",type:"close",icon:'<span class="icon-cancel"></span>'}].forEach(t=>{let e=document.createElement("li");e.className="toolSelect";let i=document.createElement("a");e.appendChild(i),i.innerHTML=t.icon?t.icon:t.value,i.className=t.type,t.draggable&&(i.draggable=!0),i.dataset.type=t.type,i.id=t.id,i.title=t.title,this.ul.appendChild(e)}),this.menuWidth=this.ul.clientWidth,this.menuHeight=this.ul.clientHeight,document.body.addEventListener("touchstart",this.dragStart.bind(this),!1),document.body.addEventListener("touchend",this.dragEnd.bind(this),!1),document.body.addEventListener("touchmove",this.drag.bind(this),!1),document.body.addEventListener("mousedown",this.dragStart.bind(this),!1),document.body.addEventListener("mouseup",this.dragEnd.bind(this),!1),document.body.addEventListener("mouseleave",this.dragEnd.bind(this),!1),document.body.addEventListener("mousemove",this.drag.bind(this),!1)}dragStart(t){"touchstart"===t.type?(this.initialX=t.touches[0].clientX-this.ul.offsetLeft||0,this.initialY=t.touches[0].clientY-this.ul.offsetTop||0):(this.initialX=t.clientX-this.ul.offsetLeft||0,this.initialY=t.clientY-this.ul.offsetTop||0),"move"!==t.target.id&&"icon-move"!==t.target.id||(this.ul.draggable=!0,this.active=!0)}dragEnd(t){this.initialX=this.currentX,this.initialY=this.currentY,this.ul.draggable=!1,this.active=!1}drag(t){this.active&&(t.preventDefault(),"touchmove"===t.type?(this.currentX=t.touches[0].clientX-this.initialX,this.currentY=t.touches[0].clientY-this.initialY):(this.currentX=t.clientX-this.initialX,this.currentY=t.clientY-this.initialY),this.xOffset=this.currentX,this.yOffset=this.currentY,this.setPosition(this.currentX,this.currentY,this.ul))}setPosition(t,e,i){e<0&&(e=0),e>window.innerHeight&&(e=window.innerHeight),t<0&&(t=0);let n=i.clientWidth,s=window.innerWidth-n;t>s&&(t=s),i.style.top=e+"px",i.style.left=t+"px"}}
































class g
{
    constructor(t,e){this.elem=t,this.screenshotPath=e.screenshotPath,this.options=g.parseOptions(e||{}),this.started=!1,this.tools={pencil:d,marker:f,rect:u,line:p,lineArrow:m,ellipse:c,text:v},this.tool_default="pencil",this.cPushArray=new Array,this.cStep=-1,this.strokeStyle="#ff0000",this.lineWidth=4,this.textSize=16,this.canvasPic=new Image,this.uploading=!1,this.isCopied=!1,this.initialized=!1,this.serverURI="https://screenshoteasy.com/",this.init();this.ocrWorker = null;}
    
    async init(){this.createDropArea(),await this.initOCR();this.initialized=!0,null!==this.options.onInit&&this.options.onInit(this)}
    
    
    createDropArea(){
        this.imgcroper=document.createElement("img"),
        this.imgcroper.src=this.screenshotPath,
        document.body.appendChild(this.imgcroper),
        this.croppr=new l(this.imgcroper,{startSize:[50,50,"%"],
            onInitialize:t=>{this.createCanvas(),
                document.getElementById("imageTemp")||t.regionEl.parentNode.appendChild(this.canvas),
                this.menu=new x(this.elem),
                this.createCursorDraw(),
                setTimeout(()=>{let t=this.croppr.regionEl.offsetTop,e=this.croppr.regionEl.offsetLeft;this.menu.createMenu(t-32,e),this.handleMenuClick(),this.handleColorChange(),this.handleKeyPress(),this.cropprX=e,this.cropprY=t,this.cropprWidth=this.croppr.regionEl.clientWidth,this.cropprHeight=this.croppr.regionEl.clientHeight},100)},
                onCropStart:t=>{},
                onCropEnd:t=>{this.cropprX=t.x,this.cropprY=t.y,this.cropprWidth=t.width,this.cropprHeight=t.height,this.menu.setPosition(t.x,t.y-32,this.menu.ul)},
                
                onCropMove:t=>{this.menu.setPosition(t.x,t.y-32,this.menu.ul)}})}

            showCropprHandle(t)
            {document.querySelectorAll(".croppr-handle").forEach(e=>{e.style.display=t?"block":"none"})}
            
            handleMenuClick(){
                let t=document.querySelectorAll(".toolSelect a");t.forEach(e=>{let i=e.id;switch(e.dataset.type){case"tool":e.addEventListener("click",e=>{t.forEach(t=>{t.className!=e.currentTarget.className&&t.classList.remove("active")}),e.currentTarget.classList.contains("active")?(e.currentTarget.classList.remove("active"),this.tool=null,this.canvas.style.zIndex=0,this.cursorDraw.style.display="none",this.showCropprHandle(!0)):(e.currentTarget.classList.add("active"),this.tool=new this.tools[i](this),this.canvas.style.zIndex=10,this.cursorDraw.style.display="text"==i?"none":"block",this.showCropprHandle(!1))});break;case"control":e.addEventListener("click",t=>{this.handleUndoRedo(i)});break;case"save":e.addEventListener("click",t=>{setTimeout(()=>{this.cropImage(t=>{let e=document.createElement("a");e.href=t,e.download="screenshoteasy.png",e.click()})},500)});break;case"copyClipboard":e.addEventListener("click",t=>{this.handleCopyClipboard()});break;case"close":e.addEventListener("click",t=>{this.handleCloseClick()})}})}
                
                handleCopyClipboard()
                {"text"==(this.tool&&this.tool.toolName?this.tool.toolName:"")?setTimeout(()=>{this.createCopyClipboard()},500):this.createCopyClipboard()}
                
                handleSaveClick()
                {"text"==(this.tool&&this.tool.toolName?this.tool.toolName:"")?setTimeout(()=>{this.createDownloadPNGFile()},500):this.createDownloadPNGFile()}
                
                handleCloseClick()
                {null!==this.options.onCloseClick&&this.options.onCloseClick()}
                
                handleColorChange()
                {document.getElementById("inputColor").addEventListener("change",t=>{this.strokeStyle=t.target.value;let e=document.getElementById("insertText");e&&(e.style.color=t.target.value)})}
                
                handleKeyPress()
                {document.addEventListener("keydown",t=>{if(t.ctrlKey&&"KeyP"==t.code){document.getElementById("pencil").click()}if(t.ctrlKey&&"KeyX"==t.code){document.getElementById("marker").click()}if(t.ctrlKey&&"KeyL"==t.code){document.getElementById("line").click()}if(t.ctrlKey&&"KeyA"==t.code){document.getElementById("lineArrow").click()}if(t.ctrlKey&&"KeyU"==t.code){document.getElementById("rect").click()}if(t.ctrlKey&&"KeyE"==t.code){document.getElementById("ellipse").click()}if(t.ctrlKey&&"KeyT"==t.code){document.getElementById("text").click()}if(t.ctrlKey&&"KeyI"==t.code){document.getElementById("inputColor").click()}if(t.ctrlKey&&"KeyZ"==t.code&&this.cUndo(),t.ctrlKey&&"KeyY"==t.code&&this.cRedo(),t.ctrlKey&&"KeyG"==t.code){document.getElementById("link").click()}if(t.ctrlKey&&"KeyO"==t.code){document.getElementById("view").click()}if(t.ctrlKey&&"KeyC"==t.code){document.getElementById("copyClipboard").click()}if(t.ctrlKey&&"KeyS"==t.code){document.getElementById("save").click()}if("Escape"==t.code){document.getElementById("close").click()}},!1)}
                


                createDownloadPNGFile()
                {this.cropImage(t=>{let e=document.createElement("a");e.href=t,e.download="screenshoteasy.png",e.click()})}
                
                
                dataURItoBlob(t)
                {let e=atob(t.split(",")[1]),i=t.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(e.length),s=new Uint8Array(n);for(let t=0;t<e.length;t++)s[t]=e.charCodeAt(t);return new Blob([n],{type:i})}
                
                copyImageToClipBoard(t)
                {navigator.permissions.query({name:"clipboard-write"}).then(async e=>{if("granted"===e.state){let e=[new ClipboardItem({["image/png"]:t})];navigator.clipboard.write(e).then(()=>{null!==this.options.onCopyClipboardClick&&this.options.onCopyClipboardClick(e)}).catch(t=>{console.error("Error:",t)})}})}
                
                
                createCopyClipboard()
                {this.cropImage(t=>{if(t){const e=this.dataURItoBlob(t);this.copyImageToClipBoard(e)}})}
                
                closeScreenshotLink()
                {let t=document.getElementById("screenshotlink");t&&t.parentNode.removeChild(t)}
                
                createCanvas()
                {this.canvasView=document.getElementById("cropprImageClipped"),this.canvasView.width=window.innerWidth,this.canvasView.height=window.innerHeight,this.contextView=this.canvasView.getContext("2d"),this.canvasOverlay=document.getElementById("cropprImage"),this.canvasOverlay.width=window.innerWidth,this.canvasOverlay.height=window.innerHeight,this.contextOverlay=this.canvasOverlay.getContext("2d"),this.canvas=document.createElement("canvas"),this.canvas.id="imageTemp",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context=this.canvas.getContext("2d"),this.screenshotPath?(this.bgImage=new Image,this.bgImage.src=this.screenshotPath,this.bgImage.onload=()=>{this.contextView.drawImage(this.bgImage,0,0),this.contextOverlay.drawImage(this.bgImage,0,0),this.cPush()}):this.cPush(),this.tools[this.tool_default]&&(this.tool=new this.tools[this.tool_default](this)),this.canvas.addEventListener("mousedown",this.canvasEvent.bind(this)),this.canvas.addEventListener("mousemove",this.canvasEvent.bind(this)),this.canvas.addEventListener("mouseup",this.canvasEvent.bind(this)),this.canvas.addEventListener("mouseleave",this.canvasEvent.bind(this)),this.canvas.addEventListener("wheel",this.canvasEvent.bind(this))}
                
                resizeCursor(t)
                {t.deltaY<0&&this.lineWidth<25&&(this.lineWidth++,this.cursorDraw.style.width=this.lineWidth+"px",this.cursorDraw.style.height=this.lineWidth+"px"),t.deltaY>0&&this.lineWidth>1&&(this.lineWidth--,this.cursorDraw.style.width=this.lineWidth+"px",this.cursorDraw.style.height=this.lineWidth+"px")}
                
                canvasEvent(t)
                {t.layerX||0==t.layerX?(t._x=t.layerX,t._y=t.layerY):(t.offsetX||0==t.offsetX)&&(t._x=t.offsetX,t._y=t.offsetY);var e=this.tool?this.tool[t.type]:null;e&&("mouseup"==t.type&&(this.updateImage(),this.cursorDraw.style.display="block"),"mousedown"==t.type&&(t.preventDefault?t.preventDefault():t.returnValue=!1,this.cursorDraw.style.display="none"),"mousemove"==t.type&&(t.preventDefault?t.preventDefault():t.returnValue=!1,this.cursorDraw.style.top=t.offsetY,this.cursorDraw.style.left=t.offsetX),"wheel"==t.type&&(this.tool.toolName&&"text"==this.tool.toolName||this.resizeCursor(t)),e(t))}
                
                createCursorDraw()
                {this.cursorDraw=document.createElement("div"),this.cursorDraw.className="cursor-draw",this.cursorDraw.id="cursorDraw",this.cursorDraw.style.width=this.lineWidth+"px",this.cursorDraw.style.height=this.lineWidth+"px",this.elem.appendChild(this.cursorDraw)}
                
                updateImage()
                {this.contextView.drawImage(this.canvas,0,0),this.contextOverlay.drawImage(this.canvas,0,0),this.cPush(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}
                
                cPush()
                {this.cPushArray[this.cStep]!=this.canvasView.toDataURL()&&(this.cStep++,this.cStep<this.cPushArray.length&&(this.cPushArray.length=this.cStep),this.cPushArray.push(this.canvasView.toDataURL()),document.title=this.cStep+":"+this.cPushArray.length)}
                
                cUndo()
                {this.cStep>0&&(this.cStep--,this.canvasPic.src=this.cPushArray[this.cStep],this.canvasPic.onload=()=>{this.contextView.clearRect(0,0,this.canvas.width,this.canvas.height),this.contextOverlay.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.contextView.drawImage(this.canvasPic,0,0),this.contextOverlay.drawImage(this.canvasPic,0,0)})}
                
                cRedo()
                {this.cStep<this.cPushArray.length-1&&(this.cStep++,this.canvasPic.src=this.cPushArray[this.cStep],this.canvasPic.onload=()=>{this.contextView.clearRect(0,0,this.canvas.width,this.canvas.height),this.contextOverlay.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.contextView.drawImage(this.canvasPic,0,0),this.contextOverlay.drawImage(this.canvasPic,0,0)})}
                
                handleUndoRedo(t)
                {
                    "undo"==t?this.cUndo():this.cRedo()}

                
                cropImage(t=(()=>{}))
                {let e=document.getElementById("imgCroppedCanvas");e&&e.parentNode.removeChild(),this.imgCroppedCanvas=document.createElement("canvas"),this.imgCroppedCanvas.id="imgCroppedCanvas";let i=this.imgCroppedCanvas.getContext("2d");i.clearRect(0,0,this.imgCroppedCanvas.width,this.imgCroppedCanvas.height),this.imgCroppedCanvas.width=this.cropprWidth,this.imgCroppedCanvas.height=this.cropprHeight;let n=this.cropprX,s=this.cropprY,o=this.cropprWidth,r=this.cropprHeight,a=o,h=r,l=this.imgCroppedCanvas.width/2-a/2,c=this.imgCroppedCanvas.height/2-h/2,d=new Image;d.src=this.cPushArray[this.cStep],d.onload=()=>{i.drawImage(d,n,s,o,r,l,c,a,h),t(this.imgCroppedCanvas.toDataURL())}}
                
                static parseOptions(t)
                {const e=null,i=null,n=null;let s=null;"function"==typeof t.onInit&&(s=t.onInit);let o=null;"function"==typeof t.onCloseClick&&(o=t.onCloseClick);let r=null;"function"==typeof t.onCopyClipboardClick&&(r=t.onCopyClipboardClick);const a=(t,e)=>null!==t?t:e;return{onInit:a(s,e),onCloseClick:a(o,i),onCopyClipboardClick:a(r,n)}}}
                
                e.default=class extends g{constructor(t,e){super(t,e)}}}]).default}));
//# sourceMappingURL=index.js.map